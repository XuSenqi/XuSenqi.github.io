<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="Zbg0rdOzWnb205c5VcQrMg5KgGiU83O7WEZiLcWHlOE" />
  <meta name="baidu-site-verification" content="code-CTVvBc6GO1" />

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://xusenqi.site').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="1 nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜ çº¿ä¸Šæœ‰ä¸ªç”¨nodeå¼€å‘çš„uhost-managerçš„æœåŠ¡ã€‚æ¯ä¸ªsetå†…ä¼šæœ‰å¤šå°ç‰©ç†æœºï¼Œæ¯å°ç‰©ç†æœºï¼ˆå®¿ä¸»æœºï¼‰ä¸Šå­˜åœ¨ç€1å°æˆ–è€…å¤šå°è™šæ‹Ÿæœºã€‚uhost-manageré‡Œæœ‰ä¸ªå®šæ—¶é€»è¾‘ï¼šæ¯éš”30s,ä»MongoDBé‡Œæ‹‰å–æ‰€æœ‰çš„è™šæ‹Ÿæœºçš„è®°å½•ï¼Œæ•°é‡ä¸º2000å¤šå°ï¼›å°†ä½äºåŒä¸€å°å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºèµ„æºï¼ŒåŒ…æ‹¬cpuã€å†…å­˜ã€ç£ç›˜å®¹é‡ç­‰ï¼Œåšä¸ªsumï¼Œå°†sumå†å¡«å…¥å¯¹åº”å®¿ä¸»æœºï¼ˆå…±200å¤šå°ï¼‰çš„è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸€æ¬¡nodeè¿›ç¨‹cpuè´Ÿè½½é«˜é—®é¢˜çš„å¤„ç†">
<meta property="og:url" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/index.html">
<meta property="og:site_name" content="è®¸æ£®çªçš„åšå®¢">
<meta property="og:description" content="1 nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜ çº¿ä¸Šæœ‰ä¸ªç”¨nodeå¼€å‘çš„uhost-managerçš„æœåŠ¡ã€‚æ¯ä¸ªsetå†…ä¼šæœ‰å¤šå°ç‰©ç†æœºï¼Œæ¯å°ç‰©ç†æœºï¼ˆå®¿ä¸»æœºï¼‰ä¸Šå­˜åœ¨ç€1å°æˆ–è€…å¤šå°è™šæ‹Ÿæœºã€‚uhost-manageré‡Œæœ‰ä¸ªå®šæ—¶é€»è¾‘ï¼šæ¯éš”30s,ä»MongoDBé‡Œæ‹‰å–æ‰€æœ‰çš„è™šæ‹Ÿæœºçš„è®°å½•ï¼Œæ•°é‡ä¸º2000å¤šå°ï¼›å°†ä½äºåŒä¸€å°å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºèµ„æºï¼ŒåŒ…æ‹¬cpuã€å†…å­˜ã€ç£ç›˜å®¹é‡ç­‰ï¼Œåšä¸ªsumï¼Œå°†sumå†å¡«å…¥å¯¹åº”å®¿ä¸»æœºï¼ˆå…±200å¤šå°ï¼‰çš„è®°">
<meta property="og:locale">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/uhost-manager-cpu-100.png">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/perf_top.png">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/perf_flamegraph.png">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/query%E6%97%B6lean%E7%9A%84%E4%BD%BF%E7%94%A8.png">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/%E9%87%8D%E5%A4%8D%E5%88%A4%E6%96%AD%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%80%BC%E7%9A%84%E4%BB%A3%E7%A0%81.png">
<meta property="og:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/%E8%BF%9B%E7%A8%8B%E7%9A%84cpu%E6%97%B6%E9%97%B4.png">
<meta property="article:published_time" content="2019-07-13T15:17:28.000Z">
<meta property="article:modified_time" content="2023-09-06T14:12:25.259Z">
<meta property="article:author" content="patrick.xu">
<meta property="article:tag" content="cpu">
<meta property="article:tag" content="node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/uhost-manager-cpu-100.png">

<link rel="canonical" href="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>ä¸€æ¬¡nodeè¿›ç¨‹cpuè´Ÿè½½é«˜é—®é¢˜çš„å¤„ç† | è®¸æ£®çªçš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="è®¸æ£®çªçš„åšå®¢" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">è®¸æ£®çªçš„åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">äººå¿…æœ‰æ‰€æ‰§ï¼Œæ–¹èƒ½æœ‰æ‰€æˆ</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">43</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">32</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://xusenqi.site/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ppwqgtl.png">
      <meta itemprop="name" content="patrick.xu">
      <meta itemprop="description" content="å®Œæˆæ¯”å®Œç¾æ›´é‡è¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è®¸æ£®çªçš„åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä¸€æ¬¡nodeè¿›ç¨‹cpuè´Ÿè½½é«˜é—®é¢˜çš„å¤„ç†
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-07-13 23:17:28" itemprop="dateCreated datePublished" datetime="2019-07-13T23:17:28+08:00">2019-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-09-06 22:12:25" itemprop="dateModified" datetime="2023-09-06T22:12:25+08:00">2023-09-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index">
                    <span itemprop="name">linuxæ€§èƒ½ä¼˜åŒ–</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/" class="post-meta-item leancloud_visitors" data-flag-title="ä¸€æ¬¡nodeè¿›ç¨‹cpuè´Ÿè½½é«˜é—®é¢˜çš„å¤„ç†" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>6 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1-nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜"><a href="#1-nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜" class="headerlink" title="1 nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜"></a>1 nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜</h1><ul>
<li>çº¿ä¸Šæœ‰ä¸ªç”¨nodeå¼€å‘çš„uhost-managerçš„æœåŠ¡ã€‚æ¯ä¸ªsetå†…ä¼šæœ‰å¤šå°ç‰©ç†æœºï¼Œæ¯å°ç‰©ç†æœºï¼ˆå®¿ä¸»æœºï¼‰ä¸Šå­˜åœ¨ç€1å°æˆ–è€…å¤šå°è™šæ‹Ÿæœºã€‚uhost-manageré‡Œæœ‰ä¸ªå®šæ—¶é€»è¾‘ï¼šæ¯éš”30s,ä»MongoDBé‡Œæ‹‰å–æ‰€æœ‰çš„è™šæ‹Ÿæœºçš„è®°å½•ï¼Œæ•°é‡ä¸º2000å¤šå°ï¼›å°†ä½äºåŒä¸€å°å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºèµ„æºï¼ŒåŒ…æ‹¬cpuã€å†…å­˜ã€ç£ç›˜å®¹é‡ç­‰ï¼Œåšä¸ªsumï¼Œå°†sumå†å¡«å…¥å¯¹åº”å®¿ä¸»æœºï¼ˆå…±200å¤šå°ï¼‰çš„è®°å½•é‡Œï¼Œè¡¨ç¤ºå·²ç»è¢«å ç”¨çš„èµ„æºã€‚</li>
<li>ç”±äºè®¡ç®—é‡å¤§ï¼Œå’Œä»£ç å†™å¾—å·®ï¼Œå¯¼è‡´åœ¨è¯¥å®šæ—¶çš„è®¡ç®—ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä¼šæŠŠå ç”¨çš„cpuå•æ ¸æ‰“æ»¡ï¼›å¦‚æœuhost-manageræ­¤æ—¶åˆæœ‰å…¶ä»–æ¥å£è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°å“åº”æ…¢çš„é—®é¢˜ï¼Œå¯¼è‡´è°ƒç”¨æ–¹çš„æœåŠ¡ä¹Ÿå“åº”æ…¢ï¼Œç”šè‡³ä¼šå› è¶…æ—¶å¯¼è‡´æœåŠ¡æ¥å£ä¸å¯ç”¨ã€‚</li>
</ul>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/uhost-manager-cpu-100.png" class="" title="image">
<p>è¿™ä¸ªå•æ ¸æ‰“æ»¡æŒç»­çš„æ—¶é—´çŸ­ï¼Œåœ¨1så·¦å³ã€‚</p>
<span id="more"></span>

<h1 id="2-é—®é¢˜çš„è§£å†³"><a href="#2-é—®é¢˜çš„è§£å†³" class="headerlink" title="2 é—®é¢˜çš„è§£å†³"></a>2 é—®é¢˜çš„è§£å†³</h1><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¦æ¥ä¸¤ä¸ªè¦æ€è€ƒçš„é—®é¢˜ï¼š</p>
<ul>
<li>è§£å†³æ–¹æ³• â€“&gt; æ€ä¹ˆæ”¹è¿›ä»£ç </li>
<li>æ€ä¹ˆè¡¡é‡æ”¹è¿›çš„æ•ˆæœ â€“&gt;<br>å› ä¸ºè´Ÿè½½é«˜çš„æ—¶é—´çŸ­ï¼Œç»Ÿè®¡å®æ—¶cpuè´Ÿè½½ï¼Œæƒ³åˆ°çš„å‘½ä»¤åªæœ‰topï¼Œä½†topå‘½ä»¤æœ¬èº«æ— æ³•åšåˆ°ç»Ÿè®¡ï¼ŒåŠ å…¥å•æ ¸æ‰“æ»¡æ—¶é—´ä»1ç§’é™åˆ°0.9ç§’ï¼Œæ˜¯æ— æ³•å‡­è‚‰çœ¼æ„ŸçŸ¥çš„ï¼›åƒpsã€vmstatç­‰ï¼Œä¹Ÿéƒ½ä¸æ»¡è¶³ç»Ÿè®¡æŸä¸ªè¿›ç¨‹çš„å®æ—¶è´Ÿè½½</li>
</ul>
<h2 id="2-1-ç»Ÿè®¡è¿›ç¨‹å ç”¨çš„cpuè¿è¡Œæ—¶é—´"><a href="#2-1-ç»Ÿè®¡è¿›ç¨‹å ç”¨çš„cpuè¿è¡Œæ—¶é—´" class="headerlink" title="2.1 ç»Ÿè®¡è¿›ç¨‹å ç”¨çš„cpuè¿è¡Œæ—¶é—´"></a>2.1 ç»Ÿè®¡è¿›ç¨‹å ç”¨çš„cpuè¿è¡Œæ—¶é—´</h2><p>/proc/<pid>/statè¯¥æ–‡ä»¶åŒ…å«äº†æŸä¸€è¿›ç¨‹æ‰€æœ‰çš„æ´»åŠ¨çš„ä¿¡æ¯ï¼Œè¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ã€‚</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/17273/stat</span></span><br><span class="line"><span class="attribute">17273</span> (node) R <span class="number">1369</span> <span class="number">17273</span> <span class="number">17273</span> <span class="number">0</span> -<span class="number">1</span> <span class="number">4218880</span> <span class="number">12446677</span> <span class="number">0</span> <span class="number">2</span> <span class="number">0</span> <span class="number">380634</span> <span class="number">40519</span> <span class="number">0</span> <span class="number">0</span> <span class="number">20</span> <span class="number">0</span> <span class="number">6</span> <span class="number">0</span> <span class="number">3525562392</span> <span class="number">964878336</span> <span class="number">38584</span> <span class="number">18446744073709551615</span> <span class="number">4194304</span> <span class="number">5593643</span> <span class="number">140724209068064</span> <span class="number">140400647923040</span> <span class="number">140400819234755</span> <span class="number">0</span> <span class="number">0</span> <span class="number">4096</span> <span class="number">16898</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">17</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7692288</span> <span class="number">7703720</span> <span class="number">35180544</span> <span class="number">140724209071315</span> <span class="number">140724209071434</span> <span class="number">140724209071434</span> <span class="number">140724209074154</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çœ‹éå¸¸ä¸ç›´è§‚ï¼Œé€šè¿‡ç½‘ä¸Šæ‰¾çš„ä¸€æ®µå°ä»£ç procstat[1]ï¼Œä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤ºã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@172-30-38-65</span> <span class="string">uhost-manager.logs</span>]<span class="comment"># procstat 17273</span></span><br><span class="line">                 <span class="attr">pid:</span> <span class="number">17273</span></span><br><span class="line">               <span class="attr">tcomm:</span> <span class="string">(node)</span></span><br><span class="line">                <span class="string">...</span></span><br><span class="line">               <span class="attr">utime:</span> <span class="number">3818.830000</span></span><br><span class="line">               <span class="attr">stime:</span> <span class="number">406.260000</span></span><br><span class="line">              <span class="attr">cutime:</span> <span class="number">0.000000</span></span><br><span class="line">              <span class="attr">cstime:</span> <span class="number">0.000000</span></span><br><span class="line">                 <span class="string">...</span></span><br><span class="line">              <span class="attr">start_time:</span> <span class="number">07.13</span> <span class="number">03</span><span class="string">:00</span> <span class="string">(77599.65s)</span></span><br><span class="line">                 <span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>è¿›ç¨‹çš„æ€»Cpuæ—¶é—´processCpuTime = utime + stime + cutime + cstimeï¼Œè¯¥å€¼åŒ…æ‹¬å…¶æ‰€æœ‰çº¿ç¨‹çš„cpuæ—¶é—´[2]ã€‚æ³¨ï¼šè¿™é‡Œç»Ÿè®¡å‡ºæ¥çš„å•ä½ä¸æ˜¯sï¼Œæ˜¯ç›¸å¯¹äºclock ticksæ¥è¯´çš„[3]ã€‚</p>
<p>æˆ‘ä»¬çš„è¡¡é‡æ‰‹æ®µä¸ºç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æ–°å¢çš„è¯¥è¿›ç¨‹çš„cpuæ—¶é—´ï¼›è¯¥å€¼è¶Šå°ï¼Œè¡¨ç¤ºè¿è¡Œæ—¶é—´è¶ŠçŸ­ã€‚</p>
<p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»¥å…¶ä»–ç«¯å£ï¼Œå†èµ·ä¸€ä¸ªuhost-manageræœåŠ¡ï¼Œé˜²æ­¢è¢«å…¶ä»–æœåŠ¡è°ƒç”¨ï¼›</li>
<li>å¦å¤–ï¼Œå®šæ—¶ä»»åŠ¡é‡Œåªä¿ç•™å®šæ—¶æ›´æ–°å®¿ä¸»æœºå ç”¨èµ„æºçš„æ¥å£ï¼ˆ smi_update_host_resource ï¼‰ã€‚</li>
<li>ä¸ºäº†ä½¿ç»Ÿè®¡çš„cpuå ç”¨æ—¶é—´é•¿ä¸€ç‚¹ï¼Œsmiæ”¹æˆæ¯5ç§’æ‰§è¡Œä¸€æ¬¡ï¼›æ€»å…±ç»Ÿè®¡60sã€‚æŸ¥çœ‹æ–°å¢çš„cpuæ—¶é—´ï¼ŒprocessCpuTime_60s - processCpuTime_0sã€‚</li>
</ul>
<h2 id="2-2-è§£å†³æ–¹æ³•"><a href="#2-2-è§£å†³æ–¹æ³•" class="headerlink" title="2.2 è§£å†³æ–¹æ³•"></a>2.2 è§£å†³æ–¹æ³•</h2><p>ä¸ºäº†è§£å†³ï¼Œéœ€è¦çŸ¥é“æ¶ˆè€—cpuæ€§èƒ½çš„ç¯èŠ‚åœ¨å“ªäº›æ­¥éª¤ä¸Šï¼Œå¥½è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<h3 id="2-2-1-perf"><a href="#2-2-1-perf" class="headerlink" title="2.2.1 perf"></a>2.2.1 perf</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">perf</span> top -g -p <span class="number">26642</span> -d <span class="number">1</span>  #æ­¤æ—¶uhost-manager pidä¸º<span class="number">26642</span></span><br></pre></td></tr></table></figure>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/perf_top.png" class="" title="image">
<p>è¿™é‡Œçœ‹èµ·æ¥ä¸ç›´è§‚ï¼Œå¹¶ä¸èƒ½çœ‹æ¸…æ¥šæ˜¯å“ªä¸ªæ“ä½œå¼•èµ·çš„ã€‚</p>
<h3 id="2-2-2-FlameGraph"><a href="#2-2-2-FlameGraph" class="headerlink" title="2.2.2 FlameGraph"></a>2.2.2 FlameGraph</h3><p>ç«ç„°å›¾çš„æ–¹å¼æ¯”è¾ƒç›´è§‚ï¼Œè¿™é‡Œæµ‹è¯•ä¸‹æ•ˆæœã€‚</p>
<ul>
<li>é‡‡é›†è„šæœ¬ï¼š perf record -F 99 -p 26642 -g â€“ sleep 60</li>
</ul>
<p>å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="center">é‡‡é›†é¢‘ç‡(ms)</th>
<th align="center">è¿›ç¨‹pid</th>
<th align="center">è°ƒç”¨è®°å½•</th>
<th align="center">è®°å½•æ—¶é•¿</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-F 99</td>
<td align="center">-p 26642</td>
<td align="center">-g</td>
<td align="center">â€“sleep 60</td>
</tr>
</tbody></table>
<ul>
<li>è¿›ç¨‹å¯¹åº”çš„ç¬¦å·è¡¨perf-pid.mapæƒé™è®¾ç½®ï¼š$chown root /tmp/perf-pid.mapã€‚</li>
</ul>
<p>è¸©è¿‡çš„å‘ï¼ï¼ï¼æ˜¯ä¸ºäº†æ¶ˆé™¤ä¸‹é¢è¿™ä¸ªé—®é¢˜çš„</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File /tmp/perf-PID.map <span class="keyword">not</span> <span class="keyword">owned</span> <span class="keyword">by</span> <span class="keyword">current</span> <span class="keyword">user</span> <span class="keyword">or</span> root, ignoring it (use -f <span class="keyword">to</span> override).</span><br><span class="line">Failed <span class="keyword">to</span> <span class="keyword">open</span> /tmp/perf-PID.map, continuing <span class="keyword">without</span> symbols</span><br></pre></td></tr></table></figure>
<ul>
<li>FlameGraphä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/brendangregg/</span>FlameGraph.git</span><br><span class="line">cd FlameGraph</span><br><span class="line">perf script -i perf.data &amp;&gt; perf.unfold  <span class="comment"># ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤éƒ½æ˜¯åœ¨FlameGraphç›®å½•ä¸‹æ‰§è¡Œçš„</span></span><br><span class="line">perl stackcollapse-perf.pl perf.unfold &amp;&gt; perf.folded</span><br><span class="line">perl flamegraph.pl perf.folded &gt; perf.svg</span><br></pre></td></tr></table></figure>

<ul>
<li>ç«ç„°å›¾æ•ˆæœ</li>
</ul>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/perf_flamegraph.png" class="" title="image">

<p>ç«ç„°å›¾ä¸­çœ‹åˆ°libv8.so.3.14.5æ˜¯æ¶ˆè€—cpuæœ€å¤šçš„ï¼Œä½†åº•ä¸‹çš„æ–¹å—ï¼ˆçˆ¶å‡½æ•°ï¼‰æ˜¯unknownï¼Œæ‰€ä»¥è¿˜æ˜¯æ— æ³•çŸ¥æ™“æ˜¯å“ªé‡Œè°ƒç”¨çš„ã€‚</p>
<p>ç«ç„°å›¾å½¢çŠ¶å¯¹åº”å…³ç³»</p>
<table>
<thead>
<tr>
<th align="left">å½¢çŠ¶</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ¯ä¸€ä¸ªå¹³é¢æ–¹å—</td>
<td align="left">ä¸€ä¸ªå‡½æ•°åœ¨æ ˆä¸­çš„ä½ç½®ï¼ˆä¹Ÿç§°ä¸€ä¸ªæ ˆå¸§ï¼‰</td>
</tr>
<tr>
<td align="left">Yè½´</td>
<td align="left">æ ˆçš„æ·±åº¦(ä¹Ÿå«æ ˆçš„å¸§æ•°)</td>
</tr>
<tr>
<td align="left">Xè½´</td>
<td align="left">è¡¨ç¤ºæ€»çš„æ ·ä¾‹ï¼Œä¸è¿‡å®ƒä»¬å·¦å³é¡ºåºæ²¡æœ‰ç‰¹æ®Šå«ä¹‰</td>
</tr>
<tr>
<td align="left">æ¯ä¸ªå¹³é¢æ–¹å—çš„å®½åº¦</td>
<td align="left">æ–¹å—çš„å®½åº¦æ ‡ç¤ºCPUä½¿ç”¨æ—¶é—´æˆ–è€…è¯´ç›¸å¯¹çˆ¶å‡½æ•°è€Œè¨€ä½¿ç”¨CPUçš„æ¯”ç‡ï¼Œè¶Šå®½ä»£è¡¨å ç”¨CPUçš„æ—¶é—´è¶Šé•¿ï¼Œæˆ–è€…ä½¿ç”¨CPUå¾ˆé¢‘ç¹</td>
</tr>
</tbody></table>
<h3 id="2-2-3-åŸå§‹çš„åˆ†æä»£ç æ–¹å¼ï¼ˆè‚‰çœ¼çœ‹ï¼‰"><a href="#2-2-3-åŸå§‹çš„åˆ†æä»£ç æ–¹å¼ï¼ˆè‚‰çœ¼çœ‹ï¼‰" class="headerlink" title="2.2.3 åŸå§‹çš„åˆ†æä»£ç æ–¹å¼ï¼ˆè‚‰çœ¼çœ‹ï¼‰"></a>2.2.3 åŸå§‹çš„åˆ†æä»£ç æ–¹å¼ï¼ˆè‚‰çœ¼çœ‹ï¼‰</h3><p>ä»¥ä¸Šæ‰‹æ®µä¸èµ·ä½œç”¨åï¼Œåªèƒ½é€è¡Œåˆ†æä»£ç ï¼Œçœ‹å“ªé‡Œå¯èƒ½æ¶ˆè€—çš„cpuå¤šï¼Œç„¶åä¼˜åŒ–æ‰ã€‚</p>
<h4 id="åŸå§‹çš„æ¶ˆè€—æ—¶é—´"><a href="#åŸå§‹çš„æ¶ˆè€—æ—¶é—´" class="headerlink" title="åŸå§‹çš„æ¶ˆè€—æ—¶é—´"></a>åŸå§‹çš„æ¶ˆè€—æ—¶é—´</h4><p>å…ˆæŒ‰ç…§2.1ä¸­çš„é‡‡é›†uhost-managerè¿›ç¨‹åœ¨60så†…æ¶ˆè€—çš„cpuæ—¶é—´ï¼Œä¸º10.65ã€‚è¿™é‡Œçš„æ—¶é—´é‡‡é›†æ˜¯5æ¬¡æµ‹é‡ï¼Œç„¶åå–å¹³å‡å€¼ã€‚</p>
<h4 id="lean"><a href="#lean" class="headerlink" title="lean"></a>lean</h4><p>ä»MongoDBé‡Œè¯»å–æ•°æ®æ—¶ï¼Œç”¨åˆ°mongooseçš„æ¨¡å—ã€‚ä½¿ç”¨leanå¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/query%E6%97%B6lean%E7%9A%84%E4%BD%BF%E7%94%A8.png" class="" title="image">

<blockquote>
<p>The lean option tells Mongoose to skip hydrating the result documents. This makes queries faster and less memory intensive, <strong>but the result documents are plain old JavaScript objects (POJOs), not Mongoose documents</strong>.</p>
</blockquote>
<blockquote>
<p>If youâ€™re executing a query and sending the results without modification to, say, an Express response, you should use lean. <font color=#FF0000 >In general, if you do not modify the query results and do not use custom getters, you should use lean(). If you modify the query results or rely on features like getters or transforms, you should not use lean()</font>.</p>
</blockquote>
<p>æµ‹è¯•ä¸‹æ¥ç»“æœä¸º6.5ï¼Œé™ä½äº†40%å·¦å³ï¼Œæ•ˆæœæ˜æ˜¾ã€‚</p>
<h4 id="å‡å°‘æ— ç”¨çš„é‡å¤æ‰§è¡Œçš„è¯­å¥"><a href="#å‡å°‘æ— ç”¨çš„é‡å¤æ‰§è¡Œçš„è¯­å¥" class="headerlink" title="å‡å°‘æ— ç”¨çš„é‡å¤æ‰§è¡Œçš„è¯­å¥"></a>å‡å°‘æ— ç”¨çš„é‡å¤æ‰§è¡Œçš„è¯­å¥</h4><p>ä¿®æ”¹ä¹‹åï¼Œæµ‹è¯•ä¸‹æ¥ç»“æœä¸º5.3ã€‚</p>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/%E9%87%8D%E5%A4%8D%E5%88%A4%E6%96%AD%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%80%BC%E7%9A%84%E4%BB%A3%E7%A0%81.png" class="" title="image">

<h4 id="å‡å°‘æ—¥å¿—æ‰“å°"><a href="#å‡å°‘æ—¥å¿—æ‰“å°" class="headerlink" title="å‡å°‘æ—¥å¿—æ‰“å°"></a>å‡å°‘æ—¥å¿—æ‰“å°</h4><p>å‡å°‘é‡å¤§çš„æ— ç”¨çš„æ—¥å¿—æ‰“å°åï¼Œæµ‹è¯•ä¸‹æ¥ç»“æœä¸º1.9ã€‚æ‰€ä»¥æ—¥å¿—æ‰“å°çš„cpuæ¶ˆè€—åœ¨åŸå§‹åŸºç¡€ä¸Šå äº†32%ï¼Œå³ï¼ˆ5.3-1.9)/10.65ã€‚</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯å°è™šæœºæ‰“å°ä¸‹vcpuçš„ä¸ªæ•°ï¼Œ&gt;2000</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">GLOBAL</span>.</span></span>logger.info(_vcpus);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯å°å®¿ä¸»æœºæ‰“å°ä¸‹host_id, &gt;200</span></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">GLOBAL</span>.</span></span>logger.info(<span class="string">&quot;[SMI]check:&quot;</span>, host_ids<span class="literal">[<span class="identifier">i</span>]</span>);</span><br></pre></td></tr></table></figure>

<h1 id="3-ä¼˜åŒ–æ•ˆæœ"><a href="#3-ä¼˜åŒ–æ•ˆæœ" class="headerlink" title="3 ä¼˜åŒ–æ•ˆæœ"></a>3 ä¼˜åŒ–æ•ˆæœ</h1><p>ç»è¿‡ä¼˜åŒ–åï¼Œæ¶ˆè€—æ—¶é—´æ˜¯1.9 clock ticksï¼Œç›¸å¯¹äºåŸæ¥çš„10.65 clock ticksï¼Œå‡å°‘äº†82.16%ã€‚</p>
<img src="/2019/07/13/%E4%B8%80%E6%AC%A1node%E8%BF%9B%E7%A8%8Bcpu%E8%B4%9F%E8%BD%BD100-%E9%97%AE%E9%A2%98%E7%9A%84%E5%A4%84%E7%90%86/%E8%BF%9B%E7%A8%8B%E7%9A%84cpu%E6%97%B6%E9%97%B4.png" class="" title="image">
<p>å•æ ¸å³°å€¼CPUæ¶ˆè€—ä¸º70%å·¦å³ï¼Œä¸”æŒç»­æ—¶é—´å¾ˆçŸ­ï¼Œä¸º100mså·¦å³ã€‚</p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ol>
<li><a target="_blank" rel="noopener" href="http://brokestream.com/procstat.html">procstat - displays linux proc stat (/proc/pid/stat) in human-readable format
</a></li>
<li><a target="_blank" rel="noopener" href="http://www.samirchen.com/linux-cpu-performance/">Linuxç¯å¢ƒä¸‹è¿›ç¨‹çš„CPUå ç”¨ç‡</a></li>
<li><a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man5/proc.5.html">Linux Programmerâ€™s Manual PROC(5)</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1005867">NodeJS æ€§èƒ½ä¼˜åŒ–ä¹‹ CPU çœ‹å›¾ç¯‡</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cpper.cn/2017/06/04/linux/perf/">Linuxæ€§èƒ½è°ƒä¼˜å·¥å…·perfçš„ä½¿ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yangcs.net/posts/how-to-deal-with-increasing-of-cpu-usage/">æŸä¸ªåº”ç”¨çš„ CPU ä½¿ç”¨ç‡å±…ç„¶è¾¾åˆ° 100%ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://mongoosejs.com/docs/tutorials/lean.html#lean-and-populate">Faster Mongoose Queries With Lean</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/cpu/" rel="tag"># cpu</a>
              <a href="/tags/node/" rel="tag"># node</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/06/06/%E5%85%B3%E4%BA%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%87%8D%E8%BF%9EZooKeeper%E7%9A%84%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" rel="prev" title="å…³äºå®¢æˆ·ç«¯é‡è¿ZooKeeperçš„çš„é‚£äº›äº‹å„¿">
      <i class="fa fa-chevron-left"></i> å…³äºå®¢æˆ·ç«¯é‡è¿ZooKeeperçš„çš„é‚£äº›äº‹å„¿
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/07/24/%E4%B8%80%E6%AC%A1mongo%E6%85%A2%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/" rel="next" title="ä¸€æ¬¡mongoæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–è¿‡ç¨‹">
      ä¸€æ¬¡mongoæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–è¿‡ç¨‹ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
  <div class="comments" id="comments">
      <script src="https://utteranc.es/client.js"
              repo="XuSenqi/hexo-blog-comment"
              issue-term="pathname"
              label="ğŸ’¬"
              theme="github-light"
              crossorigin="anonymous"
              async>
      </script>
  </div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-node%E8%BF%9B%E7%A8%8B%E8%B4%9F%E8%BD%BD%E9%AB%98%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">1 nodeè¿›ç¨‹è´Ÿè½½é«˜çš„é—®é¢˜</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3"><span class="nav-number">2.</span> <span class="nav-text">2 é—®é¢˜çš„è§£å†³</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E7%BB%9F%E8%AE%A1%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8%E7%9A%84cpu%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 ç»Ÿè®¡è¿›ç¨‹å ç”¨çš„cpuè¿è¡Œæ—¶é—´</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 è§£å†³æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-perf"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1 perf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-FlameGraph"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2 FlameGraph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-%E5%8E%9F%E5%A7%8B%E7%9A%84%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F%EF%BC%88%E8%82%89%E7%9C%BC%E7%9C%8B%EF%BC%89"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.2.3 åŸå§‹çš„åˆ†æä»£ç æ–¹å¼ï¼ˆè‚‰çœ¼çœ‹ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8B%E7%9A%84%E6%B6%88%E8%80%97%E6%97%B6%E9%97%B4"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">åŸå§‹çš„æ¶ˆè€—æ—¶é—´</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lean"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">lean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%8F%E5%B0%91%E6%97%A0%E7%94%A8%E7%9A%84%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">å‡å°‘æ— ç”¨çš„é‡å¤æ‰§è¡Œçš„è¯­å¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%8F%E5%B0%91%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">å‡å°‘æ—¥å¿—æ‰“å°</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C"><span class="nav-number">3.</span> <span class="nav-text">3 ä¼˜åŒ–æ•ˆæœ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">4.</span> <span class="nav-text">å‚è€ƒé“¾æ¥</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="patrick.xu"
      src="/images/ppwqgtl.png">
  <p class="site-author-name" itemprop="name">patrick.xu</p>
  <div class="site-description" itemprop="description">å®Œæˆæ¯”å®Œç¾æ›´é‡è¦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">patrick.xu</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">136k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">3:47</span>
</div>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=RuNvykqCFiSKIt83PqlqJbK0-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'RuNvykqCFiSKIt83PqlqJbK0-gzGzoHsz',
            'X-LC-Key': '9TDvi5mOVCQ0aBL2MXCwd9WC',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
